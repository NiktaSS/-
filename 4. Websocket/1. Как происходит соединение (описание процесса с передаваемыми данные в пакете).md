
**WebSocket** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ–≤–µ—Ä—Ö –æ–¥–Ω–æ–≥–æ TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç HTTP –Ω–∏–∑–∫–∏–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.  

#### **–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Handshake)**  
1. **HTTP Upgrade-–∑–∞–ø—Ä–æ—Å (–æ—Ç –∫–ª–∏–µ–Ω—Ç–∞)**  
   –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Upgrade: websocket`.  
```http
   GET /chat HTTP/1.1
   Host: example.com
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
   Sec-WebSocket-Version: 13
```  
   - `Sec-WebSocket-Key` ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á (–≤ base64).  
   - `Sec-WebSocket-Version` ‚Äî –≤–µ—Ä—Å–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (–æ–±—ã—á–Ω–æ 13).  

2. **–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (101 Switching Protocols)**  
   –°–µ—Ä–≤–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ WebSocket:  
```http
   HTTP/1.1 101 Switching Protocols
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
```  
   - `Sec-WebSocket-Accept` ‚Äî —Ö—ç—à –∫–ª—é—á–∞ –∫–ª–∏–µ–Ω—Ç–∞ + GUID `258EAFA5-E914-47DA-95CA-C5AB0DC85B11`.  

3. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**  
   –ü–æ—Å–ª–µ handshake TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º, –∏ –∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä –º–æ–≥—É—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ **—Ñ—Ä–µ–π–º–æ–≤ WebSocket**.  

#### **–§—Ä–µ–π–º—ã –¥–∞–Ω–Ω—ã—Ö WebSocket**  
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ñ—Ä–µ–π–º—ã. –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:  
- **Opcode** (4 –±–∏—Ç–∞): –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1` ‚Äî —Ç–µ–∫—Å—Ç, `2` ‚Äî –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ).  
- **Payload length** (7-64 –±–∏—Ç–∞): –î–ª–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö.  
- **Masking key** (32 –±–∏—Ç–∞, –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç ‚Üí —Å–µ—Ä–≤–µ—Ä): –î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø—Ä–æ–∫—Å–∏-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.  
- **Payload data**: –°–∞–º–∏ –¥–∞–Ω–Ω—ã–µ.  

---

### **–ü—Ä–∏–º–µ—Ä –Ω–∞ Python (FastAPI + WebSocket)**  
```python
from fastapi import FastAPI, WebSocket

app = FastAPI()

@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    await websocket.accept()  # –ü—Ä–∏–Ω–∏–º–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    while True:
        data = await websocket.receive_text()  # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        await websocket.send_text(f"Echo: {data}")  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
```  

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**  
1. –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `ws://localhost:8000/ws`.  
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (`accept()`).  
3. –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ `receive_*`/`send_*`.  

---

**–ö–æ—Ä–æ—Ç–∫–æ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:**  
1. Handshake —á–µ—Ä–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å —Å `Upgrade: websocket`.  
2. –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ `101 Switching Protocols`.  
3. –û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ —Ñ—Ä–µ–π–º–∞–º–∏ (—Ç–µ–∫—Å—Ç/–±–∏–Ω–∞—Ä–Ω—ã–µ).  
4. –í Python ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (FastAPI/Flask-SocketIO).  

# –ü—Ä–∏–º–µ—Ä

### **WebSocket: –ü—Ä–∏–º–µ—Ä –Ω–∞ Flask (–±—ç–∫–µ–Ω–¥) + HTML/JS (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)**  

#### **1. –ë—ç–∫–µ–Ω–¥ –Ω–∞ Flask**  
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `flask-socketio` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WebSocket:  
```bash
pip install flask-socketio
```  

**–ö–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ (`app.py`):**  
```python
from flask import Flask, render_template
from flask_socketio import SocketIO, send

app = Flask(__name__)
app.config['SECRET_KEY'] = 'secret!'
socketio = SocketIO(app)

@app.route('/')
def index():
    return render_template('index.html')  # –û—Ç–¥–∞–µ–º HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É

@socketio.on('message')  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'message'
def handle_message(msg):
    print('Received:', msg)
    send(f"Server echoes: {msg}", broadcast=True)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º

if __name__ == '__main__':
    socketio.run(app, debug=True)
```

---

#### **2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ (HTML + JS)**  
**–§–∞–π–ª `templates/index.html`:**  
```html
<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Demo</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h1>WebSocket Chat</h1>
    <input id="messageInput" type="text" placeholder="Type a message">
    <button onclick="sendMessage()">Send</button>
    <ul id="messages"></ul>

    <script>
        const socket = io();  // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = document.getElementById('messageInput');
            socket.emit('message', input.value);  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            input.value = '';
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('message', (msg) => {
            const li = document.createElement('li');
            li.textContent = msg;
            document.getElementById('messages').appendChild(li);
        });
    </script>
</body>
</html>
```

---

### **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**  
1. **–ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è** –∫ WebSocket —á–µ—Ä–µ–∑ `io()` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞).  
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**:  
   - –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `socket.emit('message', data)`.  
   - –°–µ—Ä–≤–µ—Ä –ª–æ–≤–∏—Ç —Å–æ–±—ã—Ç–∏–µ `message` –∏ –æ—Ç–≤–µ—á–∞–µ—Ç —á–µ—Ä–µ–∑ `send()`.  
3. **–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞**:  
   - –ö–ª–∏–µ–Ω—Ç —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `message` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ —Å–ø–∏—Å–æ–∫.  

---

### **–ó–∞–ø—É—Å–∫**  
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:  
   ```bash
   python app.py
   ```  
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ `http://localhost:5000`.  
3. –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –æ–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å –ø–æ–º–µ—Ç–∫–æ–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.  

---

### **–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã**  
- **Flask-SocketIO** —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å WebSocket –≤ Python.  
- **socket.io** –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.  
- –°–æ–±—ã—Ç–∏—è (`emit`, `on`) ‚Äî –æ—Å–Ω–æ–≤–∞ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏.  

### **–ü—Ä–∏–º–µ—Ä WebSocket —Å Namespace –∏ emit –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞ (Flask + JavaScript)**  

#### **1. –ë—ç–∫–µ–Ω–¥ (Flask-SocketIO)**  

**`app.py`**  
```python
from flask import Flask, render_template
from flask_socketio import SocketIO, emit

app = Flask(__name__)
app.config['SECRET_KEY'] = 'secret!'
socketio = SocketIO(app)

# –û—Å–Ω–æ–≤–Ω–æ–π namespace (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é '/')
@socketio.on('connect', namespace='/chat')
def handle_connect():
    print('–ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ /chat')
    emit('server_response', {'data': '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç!'}, namespace='/chat')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
@socketio.on('user_message', namespace='/chat')
def handle_message(data):
    print(f"–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: {data['text']}")
    emit('server_broadcast', {'data': f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª: {data['text']}"}, 
         broadcast=True, namespace='/chat')

if __name__ == '__main__':
    socketio.run(app, debug=True)
```

---

#### **2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ (HTML + JavaScript)**  

**`templates/index.html`**  
```html
<!DOCTYPE html>
<html>
<head>
    <title>WebSocket —Å Namespace</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h1>–ß–∞—Ç (/chat namespace)</h1>
    <input id="messageInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="output"></div>

    <script>
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ namespace '/chat'
        const socket = io('/chat');

        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('server_response', (data) => {
            appendMessage(`–°–µ—Ä–≤–µ—Ä: ${data.data}`);
        });

        // –°–ª—É—à–∞–µ–º broadcast-—Å–æ–æ–±—â–µ–Ω–∏—è
        socket.on('server_broadcast', (data) => {
            appendMessage(`–í—Å–µ–º: ${data.data}`);
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = document.getElementById('messageInput');
            socket.emit('user_message', {'text': input.value});
            input.value = '';
        }

        // –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ DOM
        function appendMessage(msg) {
            const div = document.createElement('div');
            div.textContent = msg;
            document.getElementById('output').appendChild(div);
        }
    </script>
</body>
</html>
```

---

### **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?**  
1. **Namespace `/chat`**  
   - –°–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (`/chat`), –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –¥—Ä—É–≥–∏—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/notifications`).  

2. **–°–æ–±—ã—Ç–∏—è:**  
   - `connect` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ namespace.  
   - `user_message` ‚Äî –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –≤—Å–µ–º (`broadcast=True`).  

3. **–ú–µ—Ç–æ–¥—ã:**  
   - `emit()` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ namespace.  
   - `socket.emit()` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.  

---

### **–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å?**  
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:  
   ```bash
   pip install flask-socketio
   ```  
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:  
   ```bash
   python app.py
   ```  
3. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:5000` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.  

---

### **–†–µ–∑—É–ª—å—Ç–∞—Ç**  
- –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (`server_response`).  
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞—Å—Å—ã–ª–∞—é—Ç—Å—è –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º (`server_broadcast`).  

---

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**  
- **–ö–æ–º–Ω–∞—Ç—ã (Rooms):**  
  –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≥—Ä—É–ø–ø–∞–º, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `join_room()` –∏ `leave_room()`:  
  ```python
  @socketio.on('join', namespace='/chat')
  def on_join(data):
      room = data['room']
      join_room(room)
      emit('room_message', f'–í—ã –≤ –∫–æ–º–Ω–∞—Ç–µ {room}', room=room)
  ```  

- **–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏—è:**  
  ```python
  socketio.emit('notification', {'data': '–í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!'}, namespace='/chat')
  ```  


## üì° –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ Django Channels ‚Äî –ø–æ —à–∞–≥–∞–º:

### 1. üë®‚Äçüíª –ö–ª–∏–µ–Ω—Ç (–æ–±—ã—á–Ω–æ JS –≤ –±—Ä–∞—É–∑–µ—Ä–µ) –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

```javascript
const socket = new WebSocket("ws://localhost:8000/ws/chat/room123/");
```

- –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π WebSocket-–∑–∞–ø—Ä–æ—Å** –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–Ω–µ –æ–±—ã—á–Ω—ã–π HTTP).
- –ü—Ä–æ—Ç–æ–∫–æ–ª ‚Äî `ws://` –∏–ª–∏ `wss://` (–µ—Å–ª–∏ HTTPS).

---

### 2. üåê –°–µ—Ä–≤–µ—Ä (Django + Channels) –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å

–í `routing.py` —Ç—ã —É–∫–∞–∑—ã–≤–∞–µ—à—å, **–∫—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å WebSocket-–∑–∞–ø—Ä–æ—Å—ã**:

```python
from django.urls import re_path
from . import consumers

websocket_urlpatterns = [
    re_path(r"ws/chat/(?P<room_name>\w+)/$", consumers.ChatConsumer.as_asgi()),
]
```

üìå –≠—Ç–æ –∫–∞–∫ `urls.py`, —Ç–æ–ª—å–∫–æ –¥–ª—è WebSocket.

---

### 3. ‚öôÔ∏è Channels –∑–∞–ø—É—Å–∫–∞–µ—Ç Consumer (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)

–ù–∞–ø—Ä–∏–º–µ—Ä, `ChatConsumer`:

```python
from channels.generic.websocket import AsyncWebsocketConsumer
import json

class ChatConsumer(AsyncWebsocketConsumer):
    async def connect(self):
        self.room_name = self.scope['url_route']['kwargs']['room_name']
        self.room_group_name = f"chat_{self.room_name}"

        # –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –≥—Ä—É–ø–ø–µ
        await self.channel_layer.group_add(
            self.room_group_name,
            self.channel_name
        )

        await self.accept()  # –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

    async def disconnect(self, close_code):
        await self.channel_layer.group_discard(
            self.room_group_name,
            self.channel_name
        )

    async def receive(self, text_data):
        data = json.loads(text_data)
        message = data['message']

        # –†–∞—Å—Å—ã–ª–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥—Ä—É–≥–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º –≤ –≥—Ä—É–ø–ø–µ
        await self.channel_layer.group_send(
            self.room_group_name,
            {
                'type': 'chat_message',
                'message': message
            }
        )

    async def chat_message(self, event):
        await self.send(text_data=json.dumps({
            'message': event['message']
        }))
```

---

## üîÅ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø—Ä–∏ `connect()`:

1. Django Channels –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `connect()` –≤ `AsyncWebsocketConsumer`.
    
2. `await self.accept()` ‚Äî —Å–µ—Ä–≤–µ—Ä **—Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** (–µ—Å–ª–∏ –Ω–µ –≤—ã–∑–æ–≤–µ—à—å ‚Äî –æ–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è).
    
3. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ **–∫–∞–Ω–∞–ª –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç** ‚Äî –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã.
    

---

## üìù –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —ç–∫–∑–∞–º–µ–Ω–µ:

> ¬´–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WebSocket-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –í Channels —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è consumer'–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä `ChatConsumer`, –≥–¥–µ –º–µ—Ç–æ–¥ `connect()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –í–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `accept()`, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–∞–Ω–∞–ª –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö¬ª.
